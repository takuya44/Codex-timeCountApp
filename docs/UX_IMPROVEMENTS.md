# タイマー UI/UX 改善提案（対応事項）

本ドキュメントは、Learning Next 風デザインルール（docs/DESIGN_RULE.md）に準拠しつつ、UI/UX を向上するための対応事項を整理したものです。優先度ごとに、目的・実施内容・受け入れ基準（Done 条件）を明記します。

## 方針
- アクセシビリティ最優先（WCAG コントラスト/フォーカスリング/キーボード操作/aria-live 最適化）
- 認知負荷を減らすテキストと視覚フィードバック（色/影/進捗）
- 誤操作防止（破壊的操作の二段階化・距離確保）
- 学習コストが低い操作モデル（プリセット、ショートカット、永続化）

---

## 高優先（体験に直結）

### 1) 動作ラベルの動的変更（開始/再開/一時停止）
- 目的: 状態が一目でわかるラベルに切替え、誤操作を防止。
- 実施:
  - 計測停止中: `開始`
  - 計測中: `一時停止`（既存の Pause を強調）
  - 一時停止中: `再開`（Start ボタンのラベル切替）
  - aria-label も同時に状態準拠へ更新
- Done 条件:
  - 状態遷移ごとにボタンラベル/aria-label が適切に更新される
  - キーボード/スクリーンリーダーでも文脈が誤解なく伝わる

### 2) リセットの誤操作対策（二段階）
- 目的: 破壊的操作（リセット）の誤タップ/誤クリックを抑制。
- 実施（いずれか）:
  - 長押し 0.8s 以上で発火（プログレスリングの視覚フィードバック）
  - 1 回目押下で確認状態（`もう一度でリセット` 表示）→ 3 秒以内の 2 回目で実行
- Done 条件:
  - 1 アクションのみではリセットが実行されない
  - アクセシブルネームと説明で意図が伝わる（aria-live/説明文）

### 3) 進捗の可視化（カウントダウン）
- 目的: 残り時間の把握を容易にし、締切接近を色で示唆。
- 実施:
  - 水平プログレスバー（幅: 100%）をタイマー下に追加
  - 残り 10 秒で `amber`、5 秒で `red` に色変化（背景=白, テキスト=白, コントラスト配慮）
- Done 条件:
  - 進捗が 0–100% で滑らかに更新
  - 10s/5s 到達で色変化し、コントラスト 4.5:1 以上

### 4) 読み上げの最適化（aria-live）
- 目的: 過度な読み上げを避けつつ、状態変化のみを確実に通知。
- 実施:
  - 時間表示から `aria-live` を外し、ステータス用要素のみ `aria-live="polite"` を維持
  - 完了/開始/一時停止/再開/リセット/エラー時のみ通知
- Done 条件:
  - 毎秒・毎フレームの読み上げが発生しない
  - 主要イベントで確実に読み上げが行われる

### 5) プリセット拡張（頻用/ショートカット/永続化）
- 目的: よく使う時間の即時設定と再利用で操作を簡略化。
- 実施:
  - 「最後に使用した時間」をローカル保存し、先頭プリセットとして表示
  - キーボード `1/2/3` でプリセット選択、`Enter` で開始
  - プリセット群の並び替え（使用頻度/最近使用）
- Done 条件:
  - 再訪時に最後の値が復元
  - ショートカットがドキュメント化され、動作する

---

## 中優先（磨き込み）

### 6) セグメントコントロールのキーボード操作（ARIA Tabs）
- 目的: ロービングタブインデックスでタブ移動を自然に。
- 実施: 左右矢印でフォーカス移動、Home/End で先頭/末尾、Enter/Space で選択
- Done 条件: WAI-ARIA Authoring Practices の Tabs 実装基準を満たす

### 7) 桁揃え（tabular-nums）
- 目的: 時間の桁ズレを防ぎ、読み取りやすくする。
- 実施: `.time-text { font-variant-numeric: tabular-nums; }`
- Done 条件: 数字の幅が等幅になり、表示が安定

### 8) 完了フィードバック（音/通知/バイブ）
- 目的: 画面非注視時でも完了を認知可能に。
- 実施: サウンド（任意）、Notification API、モバイルのバイブ（可能な範囲）
- Done 条件: 設定でオン/オフ可能、初期値はオフ、ユーザー選好を保存

### 9) エラー説明とヘルプテキスト
- 目的: 入力制約の理解を助け、エラー時の修正を容易に。
- 実施: `aria-describedby` で「秒は0–59」などの補助テキストを関連付け
- Done 条件: 範囲外入力時に明確な説明が表示/読み上げされる

### 10) モバイル誤タップ防止の配置
- 目的: 破壊的操作と主要操作の距離を確保。
- 実施: リセットを行グループの端に配置し、周囲に余白を追加（gap 拡大）
- Done 条件: 最小タッチターゲット 44px、誤タップの発生率が下がる

### 11) 設定の永続化
- 目的: 利用者の習慣を学習し、次回起動時の操作を短縮。
- 実施: 分/秒、プリセット選好、ボタンスタイル（アウトライン/ソリッド）を `localStorage` に保存
- Done 条件: 再訪時の復元、初回はデフォルト値

---

## 実装メモ（設計ルール対応）
- 配色: システムカラー（amber/red/blue）を `--amber-700`/`--red-600`/`--blue-500` で適用、白文字時はコントラスト 4.5:1 以上
- 影: インタラクティブ要素は `shadow-sm` 以上、ホバーで 1 段強化
- フォーカス: `ring-2` 相当のフォーカスリング（ボタン/入力/タブ）
- 余白: 8px ベース、ボタンは高さ 44px 以上
- 動き: `prefers-reduced-motion` を尊重（アニメーション/トランジション抑制）

## 検証チェックリスト
- [ ] コントラスト比（通常 4.5:1 以上、重要情報 7:1 以上）
- [ ] キーボード操作（タブ移動、矢印操作、Enter/Space 発火）
- [ ] スクリーンリーダー（開始/一時停止/再開/完了/エラーの読み上げ）
- [ ] タッチ操作（44px 以上、誤タップ防止）
- [ ] 多ブラウザ/多デバイス表示確認
- [ ] パフォーマンス（不要な再描画やタイマー負荷がない）

## 次アクション（提案）
1. 高優先 5 項目を順に実装（小 PR 分割）
2. 併せて単体テスト（ユーティリティ/状態遷移）と e2e 触りの確認手順を整備
3. 通知/音の許可ダイアログの UX を検討（初回のみ、設定で再変更可能）

